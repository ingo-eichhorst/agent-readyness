---
phase: 04-recommendations-and-output
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - internal/output/terminal.go
  - internal/output/terminal_test.go
  - internal/output/json.go
  - internal/output/json_test.go
autonomous: true

must_haves:
  truths:
    - "Terminal output displays recommendations with rank, impact, effort, and agent-readiness framing"
    - "JSON output produces valid JSON with composite score, tier, categories, and recommendations"
    - "JSON output contains no ANSI escape sequences"
    - "Verbose mode adds per-metric breakdowns to both terminal and JSON output"
  artifacts:
    - path: "internal/output/json.go"
      provides: "JSON report types and RenderJSON function"
      exports: ["JSONReport", "RenderJSON", "BuildJSONReport"]
    - path: "internal/output/terminal.go"
      provides: "RenderRecommendations function"
      exports: ["RenderRecommendations"]
  key_links:
    - from: "internal/output/terminal.go"
      to: "internal/recommend"
      via: "recommend.Recommendation type in RenderRecommendations signature"
      pattern: "recommend\\.Recommendation"
    - from: "internal/output/json.go"
      to: "pkg/types/scoring.go"
      via: "types.ScoredResult conversion to JSONReport"
      pattern: "types\\.ScoredResult"
    - from: "internal/output/json.go"
      to: "internal/recommend"
      via: "recommend.Recommendation included in JSON output"
      pattern: "recommend\\.Recommendation"
---

<objective>
Add terminal recommendation rendering and JSON output to the output package.

Purpose: Users need to see recommendations in the terminal alongside scores, and CI tools need machine-readable JSON output. These are two rendering paths for the same data.
Output: `RenderRecommendations` function in terminal.go, new `json.go` with JSON report types and renderer.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-recommendations-and-output/04-RESEARCH.md
@.planning/phases/04-recommendations-and-output/04-01-SUMMARY.md
@internal/output/terminal.go
@internal/output/terminal_test.go
@pkg/types/scoring.go
@internal/recommend/recommend.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Terminal recommendation rendering</name>
  <files>internal/output/terminal.go, internal/output/terminal_test.go</files>
  <action>
    Add `RenderRecommendations(w io.Writer, recs []recommend.Recommendation)` to terminal.go.

    Layout (matching research pattern):
    - Blank line, then bold "Top Recommendations" header
    - Separator line using double-line box drawing chars (matching RenderScores style)
    - For each recommendation (numbered 1-N):
      - Line 1: "  {rank}. {Summary}" -- bold
      - Line 2: "     Impact: +{ScoreImprovement:.1f} points" -- colored by scoreColor helper (green if >= 0.5, yellow if >= 0.2, red otherwise)
      - Line 3: "     Effort: {Effort}" -- plain
      - Line 4: "     Action: {Action}" -- plain
      - Blank line between recommendations
    - If recs is empty, print "  No recommendations -- all metrics are excellent!" (green)

    Import the recommend package. Add tests that verify:
    - Recommendations render with correct numbering
    - Empty list renders the "excellent" message
    - Output contains expected strings (not pixel-perfect, just key content)
  </action>
  <verify>
    ```bash
    cd /Users/ingo/agent-readyness && go test ./internal/output/ -v -run TestRender -count=1
    ```
  </verify>
  <done>RenderRecommendations produces formatted terminal output with rank, impact, effort, action for each recommendation. Empty case handled gracefully.</done>
</task>

<task type="auto">
  <name>Task 2: JSON output types and renderer</name>
  <files>internal/output/json.go, internal/output/json_test.go</files>
  <action>
    Create `internal/output/json.go` with:

    JSON output types with struct tags:
    ```
    JSONReport {
      Version          string             `json:"version"`           // "1"
      CompositeScore   float64            `json:"composite_score"`
      Tier             string             `json:"tier"`
      Categories       []JSONCategory     `json:"categories"`
      Recommendations  []JSONRecommendation `json:"recommendations"`
    }

    JSONCategory {
      Name    string       `json:"name"`
      Score   float64      `json:"score"`
      Weight  float64      `json:"weight"`
      Metrics []JSONMetric `json:"metrics,omitempty"`  // only populated when verbose=true
    }

    JSONMetric {
      Name     string  `json:"name"`
      RawValue float64 `json:"raw_value"`
      Score    float64 `json:"score"`
      Weight   float64 `json:"weight"`
      Available bool   `json:"available"`
    }

    JSONRecommendation {
      Rank             int     `json:"rank"`
      Category         string  `json:"category"`
      MetricName       string  `json:"metric_name"`
      CurrentValue     float64 `json:"current_value"`
      CurrentScore     float64 `json:"current_score"`
      TargetValue      float64 `json:"target_value"`
      ScoreImprovement float64 `json:"score_improvement"`
      Effort           string  `json:"effort"`
      Summary          string  `json:"summary"`
      Action           string  `json:"action"`
    }
    ```

    Functions:
    - `BuildJSONReport(scored *types.ScoredResult, recs []recommend.Recommendation, verbose bool) *JSONReport`
      - Converts ScoredResult + recommendations into JSONReport
      - When verbose=true, populates Metrics array in each category from SubScores
      - When verbose=false, Metrics is nil (omitted from JSON via omitempty)
      - Sets Version to "1"
    - `RenderJSON(w io.Writer, report *JSONReport) error`
      - Uses json.NewEncoder with SetIndent("", "  ") for pretty printing
      - Never touches fatih/color -- completely separate rendering path

    Create `internal/output/json_test.go` with tests:
    - Verify JSON output is valid JSON (json.Valid)
    - Verify JSON contains no ANSI escape sequences (no \x1b)
    - Verify verbose adds metrics, non-verbose omits them
    - Verify version field is "1"
    - Verify recommendations are included in output
  </action>
  <verify>
    ```bash
    cd /Users/ingo/agent-readyness && go test ./internal/output/ -v -run TestJSON -count=1
    ```
  </verify>
  <done>JSON output produces valid, ANSI-free JSON with scores, tier, categories, recommendations. Verbose mode adds per-metric details.</done>
</task>

</tasks>

<verification>
```bash
cd /Users/ingo/agent-readyness && go test ./internal/output/ -v -count=1
cd /Users/ingo/agent-readyness && go vet ./internal/output/
```
All output tests pass. No vet issues.
</verification>

<success_criteria>
- RenderRecommendations displays ranked recommendations with agent-readiness framing in terminal
- RenderJSON produces valid JSON without ANSI codes
- BuildJSONReport correctly converts internal types to JSON-tagged structs
- Verbose flag controls metric detail inclusion in JSON
- Both renderers handle empty recommendations gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/04-recommendations-and-output/04-02-SUMMARY.md`
</output>
