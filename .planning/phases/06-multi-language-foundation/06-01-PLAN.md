---
phase: 06-multi-language-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pkg/types/types.go
  - pkg/types/scoring.go
  - internal/pipeline/interfaces.go
  - internal/pipeline/pipeline.go
  - internal/analyzer/c1_codehealth.go
  - internal/analyzer/c3_architecture.go
  - internal/analyzer/c6_testing.go
  - internal/analyzer/helpers.go
autonomous: true

must_haves:
  truths:
    - "Existing ars scan command still works on Go projects with identical output"
    - "AnalysisTarget type exists with Language, RootDir, Files fields"
    - "Analyzer interface accepts []*types.AnalysisTarget instead of []*parser.ParsedPackage"
    - "All existing tests pass after refactoring"
  artifacts:
    - path: "pkg/types/types.go"
      provides: "AnalysisTarget, Language, SourceFile types"
      contains: "type AnalysisTarget struct"
    - path: "internal/pipeline/interfaces.go"
      provides: "New Analyzer and GoAwareAnalyzer interfaces"
      contains: "GoAwareAnalyzer"
    - path: "internal/pipeline/pipeline.go"
      provides: "Pipeline creating AnalysisTargets from Go packages"
      contains: "AnalysisTarget"
  key_links:
    - from: "internal/pipeline/pipeline.go"
      to: "internal/analyzer/c1_codehealth.go"
      via: "GoAwareAnalyzer.SetGoPackages then Analyzer.Analyze"
      pattern: "SetGoPackages"
    - from: "internal/pipeline/pipeline.go"
      to: "pkg/types/types.go"
      via: "Creates AnalysisTarget from parsed Go packages"
      pattern: "AnalysisTarget"
---

<objective>
Introduce the language-agnostic AnalysisTarget abstraction and refactor all pipeline interfaces from Go-specific ParsedPackage to the new multi-language types. Existing Go analysis must continue working identically.

Purpose: This is the foundational refactoring that enables all multi-language work. Every subsequent plan in Phase 6 depends on these types and interfaces existing.
Output: Refactored types, interfaces, pipeline, and analyzers. All existing tests still pass.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-multi-language-foundation/06-RESEARCH.md

@pkg/types/types.go
@pkg/types/scoring.go
@internal/pipeline/interfaces.go
@internal/pipeline/pipeline.go
@internal/analyzer/c1_codehealth.go
@internal/analyzer/c3_architecture.go
@internal/analyzer/c6_testing.go
@internal/analyzer/helpers.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add multi-language types and refactor interfaces</name>
  <files>
    pkg/types/types.go
    internal/pipeline/interfaces.go
  </files>
  <action>
In `pkg/types/types.go`, add these types BEFORE existing types (keep all existing types):

```go
type Language string

const (
    LangGo         Language = "go"
    LangPython     Language = "python"
    LangTypeScript Language = "typescript"
)

// AnalysisTarget is the language-agnostic unit of analysis.
// Each target represents one language found in the project.
type AnalysisTarget struct {
    Language Language
    RootDir  string       // Project root directory
    Files    []SourceFile // Source files for this language
}

// SourceFile represents a single source file for analysis.
type SourceFile struct {
    Path     string
    RelPath  string
    Language Language
    Lines    int
    Content  []byte    // Raw source content (needed for Tree-sitter)
    Class    FileClass // source, test, generated, excluded
}
```

In `internal/pipeline/interfaces.go`, replace the current interfaces:

1. Change `Analyzer` interface to: `Analyze(targets []*types.AnalysisTarget) (*types.AnalysisResult, error)` (replaces ParsedPackage parameter)
2. Add `GoAwareAnalyzer` interface that embeds `Analyzer` and adds `SetGoPackages(pkgs []*parser.ParsedPackage)`
3. Update `StubAnalyzer.Analyze` signature to match new interface
4. Remove `StubParser` (will be replaced by multi-parser approach)
5. Keep `Parser` interface but note it will be deprecated -- for now keep it for Go parser compatibility
  </action>
  <verify>
`cd /Users/ingo/agent-readyness && go build ./...` compiles (may have errors in analyzers -- that is expected, fixed in Task 2)
  </verify>
  <done>AnalysisTarget, Language, SourceFile types exist in types.go. Pipeline interfaces use AnalysisTarget. GoAwareAnalyzer interface exists.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor analyzers and pipeline to use AnalysisTarget</name>
  <files>
    internal/analyzer/c1_codehealth.go
    internal/analyzer/c3_architecture.go
    internal/analyzer/c6_testing.go
    internal/analyzer/helpers.go
    internal/pipeline/pipeline.go
  </files>
  <action>
Refactor C1, C3, C6 analyzers to implement `GoAwareAnalyzer`:

For each analyzer (C1Analyzer, C3Analyzer, C6Analyzer):
1. Add a `pkgs []*parser.ParsedPackage` field to the struct
2. Add `SetGoPackages(pkgs []*parser.ParsedPackage)` method that stores pkgs on the struct
3. Change `Analyze` signature from `Analyze(pkgs []*parser.ParsedPackage)` to `Analyze(targets []*types.AnalysisTarget)`
4. Inside Analyze, use `a.pkgs` (set via SetGoPackages) instead of the parameter. The `targets` parameter is available for future multi-language use but Go analyzers use their stored packages.
5. Keep all internal analysis logic UNCHANGED -- only the entry point signature changes

Update `internal/pipeline/pipeline.go`:
1. After parsing Go packages (stage 2), create an `[]*types.AnalysisTarget` with one Go target containing SourceFiles derived from the parsed packages
2. Before running analyzers, call `SetGoPackages(pkgs)` on any analyzer that implements `GoAwareAnalyzer` (use type assertion)
3. Pass the targets slice to each analyzer's `Analyze()` method
4. Keep all other pipeline logic (discover, score, render, threshold) unchanged

For creating the Go AnalysisTarget: iterate over parsed packages, collect unique GoFiles, build SourceFile entries with Language: types.LangGo, RelPath computed from rootDir, and Class based on whether it is a test file (ForTest != ""). Lines and Content can be 0/nil for now (Go analyzers use ParsedPackage, not SourceFile).

Update helpers.go if it has any ParsedPackage-specific helpers that need signature changes.

CRITICAL: Do not change any analysis logic. This is purely an interface refactoring. The goal is that `go test ./...` passes with identical behavior.
  </action>
  <verify>
`cd /Users/ingo/agent-readyness && go test ./... 2>&1` -- all tests pass. Then `cd /Users/ingo/agent-readyness && go build -o /tmp/ars-test ./main.go && /tmp/ars-test scan .` produces output (scores, recommendations).
  </verify>
  <done>All three analyzers implement GoAwareAnalyzer. Pipeline creates AnalysisTarget and calls SetGoPackages. All existing tests pass. `ars scan` produces identical output on Go projects.</done>
</task>

</tasks>

<verification>
1. `go build ./...` succeeds
2. `go test ./...` all tests pass
3. `go vet ./...` no issues
4. `go build -o /tmp/ars-test ./main.go && /tmp/ars-test scan .` works and shows C1/C3/C6 scores
5. AnalysisTarget type exists with Language, RootDir, Files fields
6. GoAwareAnalyzer interface exists with SetGoPackages method
</verification>

<success_criteria>
- Zero test regressions
- AnalysisTarget is the new abstraction used by the pipeline
- Go analysis works identically to v1
- Foundation is ready for multi-language parsers and analyzers
</success_criteria>

<output>
After completion, create `.planning/phases/06-multi-language-foundation/06-01-SUMMARY.md`
</output>
