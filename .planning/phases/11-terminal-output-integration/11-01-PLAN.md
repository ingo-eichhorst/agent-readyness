---
phase: 11-terminal-output-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/output/terminal.go
  - internal/output/terminal_test.go
autonomous: true

must_haves:
  truths:
    - "User sees C7 category header in terminal output when --enable-c7 used"
    - "User sees 4 C7 metrics: intent clarity, modification confidence, cross-file coherence, semantic completeness"
    - "User sees 'Not available' message when C7 is disabled"
    - "Verbose mode shows per-task breakdown with score, status, duration, reasoning"
  artifacts:
    - path: "internal/output/terminal.go"
      provides: "renderC7 function + switch case + display name mappings"
      contains: "func renderC7"
    - path: "internal/output/terminal_test.go"
      provides: "C7 rendering test coverage"
      contains: "C7: Agent Evaluation"
  key_links:
    - from: "internal/output/terminal.go:RenderSummary"
      to: "renderC7"
      via: "switch case in analysisResults loop"
      pattern: 'case "C7":'
    - from: "internal/output/terminal.go:categoryDisplayNames"
      to: "C7 display"
      via: "map entry"
      pattern: '"C7".*"Agent Evaluation"'
---

<objective>
Add C7 agent evaluation terminal rendering to complete the E2E flow for `--enable-c7`.

Purpose: Users currently can only see C7 metrics via JSON output. This plan adds terminal display so the C7 category appears alongside C1-C6 in the standard scan output.

Output: Working renderC7 function with tests, following established patterns from renderC4/C5/C6.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-terminal-output-integration/11-RESEARCH.md
@internal/output/terminal.go
@internal/output/terminal_test.go
@pkg/types/types.go (C7Metrics struct lines 252-274)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add renderC7 function and integration points</name>
  <files>internal/output/terminal.go</files>
  <action>
Add C7 terminal rendering following the established pattern from renderC4, renderC5, renderC6:

1. Add `renderC7(w io.Writer, ar *types.AnalysisResult, verbose bool)` function after renderC6:
   - Extract metrics: `raw, ok := ar.Metrics["c7"]` then type assert to `*types.C7Metrics`
   - Print header: bold "C7: Agent Evaluation" with 40-dash separator line
   - Check `m.Available`: if false, print "Not available (--enable-c7 not specified)" and return
   - Display 4 core metrics with color coding (use 70/40 thresholds for green/yellow/red):
     - Intent clarity: `IntentClarity` (0-100)
     - Modification confidence: `ModificationConfidence` (0-100)
     - Cross-file coherence: `CrossFileCoherence` (0-100)
     - Semantic completeness: `SemanticCompleteness` (0-100)
   - Display summary metrics:
     - Overall score: `OverallScore` (0-100)
     - Duration: `TotalDuration` (seconds)
     - Estimated cost: `CostUSD` (format as $X.XXXX)
   - Verbose mode: if `verbose && len(m.TaskResults) > 0`, show per-task breakdown:
     - Header: bold "Per-task results:"
     - For each TaskResult: `TaskName: score=X status=Y (Z.Xs)`
     - If Reasoning non-empty, show indented: `Reasoning: {reasoning}`

2. Add helper function `c7ScoreColor(score int) *color.Color`:
   - score >= 70: return green
   - score >= 40: return yellow
   - score < 40: return red

3. Add switch case in RenderSummary (around line 80, after case "C6"):
   ```go
   case "C7":
       renderC7(w, ar, verbose)
   ```

4. Add to categoryDisplayNames map (around line 490):
   ```go
   "C7": "Agent Evaluation",
   ```

5. Add to metricDisplayNames map (after existing C4 metrics section):
   ```go
   // C7 metrics
   "intent_clarity":          "Intent clarity",
   "modification_confidence": "Modification confidence",
   "cross_file_coherence":    "Cross-file coherence",
   "semantic_completeness":   "Semantic completeness",
   ```

Use consistent formatting:
- Label width: 24 chars left-aligned (matching other categories)
- Score format: `%d/100` for individual metrics
- Use `colorForFloatInverse` pattern adapted for int (higher is better)
  </action>
  <verify>
Run: `go build ./...` succeeds with no errors
Grep: `grep -n "func renderC7" internal/output/terminal.go` returns line number
Grep: `grep -n 'case "C7"' internal/output/terminal.go` returns line number
  </verify>
  <done>
renderC7 function exists and compiles, switch case added, display names registered
  </done>
</task>

<task type="auto">
  <name>Task 2: Add C7 rendering tests</name>
  <files>internal/output/terminal_test.go</files>
  <action>
Add test coverage for C7 terminal rendering following existing test patterns:

1. Update `newTestAnalysisResults()` to include C7 test data:
   ```go
   {
       Name:     "C7: Agent Evaluation",
       Category: "C7",
       Metrics: map[string]interface{}{
           "c7": &types.C7Metrics{
               Available:              true,
               IntentClarity:          75,
               ModificationConfidence: 68,
               CrossFileCoherence:     82,
               SemanticCompleteness:   71,
               OverallScore:           74.0,
               TotalDuration:          45.5,
               CostUSD:                0.0125,
               TaskResults: []types.C7TaskResult{
                   {TaskID: "intent_clarity", TaskName: "Intent Clarity", Score: 75, Status: "completed", Duration: 12.3, Reasoning: "Clear function signatures"},
                   {TaskID: "modification_confidence", TaskName: "Modification Confidence", Score: 68, Status: "completed", Duration: 11.2, Reasoning: "Good test coverage"},
               },
           },
       },
   },
   ```

2. Add to TestRenderSummaryWithMetrics - extend c7Checks slice:
   ```go
   // C7 metrics should appear
   c7Checks := []string{
       "C7: Agent Evaluation",
       "Intent clarity:",
       "Modification confidence:",
       "Cross-file coherence:",
       "Semantic completeness:",
       "Overall score:",
       "Duration:",
       "Estimated cost:",
   }
   for _, check := range c7Checks {
       if !strings.Contains(out, check) {
           t.Errorf("output missing C7 metric %q\nGot:\n%s", check, out)
       }
   }
   ```

3. Add to TestRenderSummaryWithMetricsVerbose - extend verboseChecks:
   ```go
   // C7 verbose: per-task results
   "Per-task results:",
   "Intent Clarity:",
   "score=75",
   "completed",
   "Clear function signatures",
   ```

4. Add new test `TestRenderC7Unavailable` for disabled C7:
   ```go
   func TestRenderC7Unavailable(t *testing.T) {
       var buf bytes.Buffer
       ar := &types.AnalysisResult{
           Name:     "C7: Agent Evaluation",
           Category: "C7",
           Metrics: map[string]interface{}{
               "c7": &types.C7Metrics{
                   Available: false,
               },
           },
       }
       RenderSummary(&buf, newTestResult(), []*types.AnalysisResult{ar}, false)
       out := buf.String()

       if !strings.Contains(out, "C7: Agent Evaluation") {
           t.Error("output should contain C7 header")
       }
       if !strings.Contains(out, "Not available") {
           t.Error("output should indicate C7 not available")
       }
       // Should NOT contain metric values when unavailable
       if strings.Contains(out, "Intent clarity:") {
           t.Error("unavailable C7 should not show metric details")
       }
   }
   ```
  </action>
  <verify>
Run: `go test ./internal/output/... -v` passes all tests including new C7 tests
Grep: `grep -c "C7" internal/output/terminal_test.go` returns count > 5 (multiple C7 references)
  </verify>
  <done>
All terminal tests pass, C7 rendering has test coverage for both available and unavailable states
  </done>
</task>

</tasks>

<verification>
1. Build succeeds: `go build ./...`
2. All tests pass: `go test ./internal/output/... -v`
3. Integration check: Run `ars scan . --enable-c7` on a test repo (requires claude CLI) and verify C7 appears in terminal output
4. Fallback check: Run `ars scan .` without --enable-c7 and verify no C7 section appears (C7 analyzer not enabled by default)
</verification>

<success_criteria>
- renderC7 function exists and follows established category rendering pattern
- Switch case routes C7 to renderC7 in RenderSummary
- categoryDisplayNames includes "C7": "Agent Evaluation"
- metricDisplayNames includes all 4 C7 metrics
- Tests verify both available (with metrics) and unavailable (with message) states
- Verbose mode shows per-task breakdown
- E2E Flow 3 from audit passes: `ars scan --enable-c7` shows C7 in terminal
</success_criteria>

<output>
After completion, create `.planning/phases/11-terminal-output-integration/11-01-SUMMARY.md`
</output>
