---
phase: 13-badge-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/output/badge.go
  - internal/output/badge_test.go
  - cmd/scan.go
  - internal/output/terminal.go
  - internal/output/json.go
  - internal/output/html.go
  - internal/output/templates/report.html
  - internal/pipeline/pipeline.go
autonomous: true

must_haves:
  truths:
    - "Running `ars scan --badge <dir>` outputs shields.io badge markdown to stdout"
    - "Badge color is green for Agent-Ready, yellow for Agent-Assisted, orange for Agent-Limited, red for Agent-Hostile"
    - "Badge message shows tier name and score with one decimal (e.g., 'Agent-Ready 8.2/10')"
    - "JSON output includes badge_url and badge_markdown fields when --badge flag is used"
    - "HTML report includes a copy-able badge markdown section"
  artifacts:
    - path: "internal/output/badge.go"
      provides: "Badge URL generation"
      exports: ["GenerateBadge", "BadgeInfo"]
    - path: "internal/output/badge_test.go"
      provides: "Badge generation tests"
      contains: "TestGenerateBadge"
    - path: "cmd/scan.go"
      provides: "CLI flag"
      contains: "badge"
  key_links:
    - from: "cmd/scan.go"
      to: "internal/pipeline/pipeline.go"
      via: "badgeOutput flag passed to pipeline"
      pattern: "SetBadgeOutput|badgeOutput"
    - from: "internal/pipeline/pipeline.go"
      to: "internal/output/badge.go"
      via: "GenerateBadge call"
      pattern: "output\\.GenerateBadge"
    - from: "internal/output/terminal.go"
      to: "internal/output/badge.go"
      via: "RenderBadge call"
      pattern: "RenderBadge"
---

<objective>
Add shields.io badge URL generation with `--badge` CLI flag.

Purpose: Allow users to display ARS tier and score in their project READMEs using shields.io badges, increasing visibility of code quality metrics.

Output:
- `internal/output/badge.go` with GenerateBadge function
- `--badge` flag integration across terminal, JSON, and HTML output modes
- Tests for badge generation
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-badge-generation/13-CONTEXT.md
@.planning/phases/13-badge-generation/13-RESEARCH.md
@internal/output/terminal.go
@internal/output/json.go
@internal/output/html.go
@cmd/scan.go
@internal/pipeline/pipeline.go
@pkg/types/scoring.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create badge URL generation module</name>
  <files>internal/output/badge.go, internal/output/badge_test.go</files>
  <action>
Create `internal/output/badge.go` with:

1. `BadgeInfo` struct with `URL` (raw shields.io URL) and `Markdown` (complete markdown with link)

2. `GenerateBadge(scored *types.ScoredResult) BadgeInfo` function:
   - Return empty BadgeInfo if scored is nil
   - Format message as "{Tier} {Composite:.1f}/10" (e.g., "Agent-Ready 8.2/10")
   - Encode for shields.io URL path:
     - Replace `-` with `--` first (shields.io separator escape)
     - Then use `url.PathEscape()` (spaces become %20)
   - Map tier to color: Agent-Ready=green, Agent-Assisted=yellow, Agent-Limited=orange, Agent-Hostile=red
   - Build URL: `https://img.shields.io/badge/ARS-{encoded_message}-{color}`
   - Build markdown: `[![ARS]({url})](https://github.com/ingo-eichhorst/agent-readyness)`
   - Use const for repo URL

3. Helper functions:
   - `encodeBadgeText(s string) string` - escape dashes then PathEscape
   - `tierToColor(tier string) string` - map tier to shields.io color name

Create `internal/output/badge_test.go` with:

1. `TestGenerateBadge` table-driven tests:
   - Agent-Ready high score (8.2) -> green, correct URL encoding
   - Agent-Assisted mid score (6.5) -> yellow
   - Agent-Limited low score (4.5) -> orange
   - Agent-Hostile very low score (3.0) -> red
   - Verify URL contains `Agent--Ready` (double dash for literal dash)
   - Verify URL contains `%20` for spaces
   - Verify markdown wraps URL with link to repo

2. `TestEncodeBadgeText` tests:
   - "Agent-Ready 8.2/10" -> "Agent--Ready%208.2%2F10"
   - Spaces, slashes, dashes all encoded correctly

3. `TestTierToColor` tests:
   - Each tier maps to correct color
   - Unknown tier defaults to red
  </action>
  <verify>
```bash
go test ./internal/output/... -run TestBadge -v
go test ./internal/output/... -run TestEncode -v
go test ./internal/output/... -run TestTier -v
```
All tests pass.
  </verify>
  <done>
- `internal/output/badge.go` exports GenerateBadge and BadgeInfo
- All badge tests pass
- GenerateBadge returns correctly formatted shields.io URL and markdown
  </done>
</task>

<task type="auto">
  <name>Task 2: Add --badge CLI flag and integrate with output modes</name>
  <files>cmd/scan.go, internal/pipeline/pipeline.go, internal/output/terminal.go, internal/output/json.go</files>
  <action>
**cmd/scan.go:**
1. Add `badgeOutput bool` variable with other flags
2. Add flag: `scanCmd.Flags().BoolVar(&badgeOutput, "badge", false, "generate shields.io badge markdown URL")`
3. Pass badgeOutput to pipeline: `p.SetBadgeOutput(badgeOutput)`

**internal/pipeline/pipeline.go:**
1. Add `badgeOutput bool` field to Pipeline struct
2. Add `SetBadgeOutput(enabled bool)` method
3. In `Run()` method, pass badgeOutput when calling output functions:
   - For JSON: pass to BuildJSONReport
   - For terminal: call RenderBadge after RenderRecommendations if badgeOutput && scored != nil

**internal/output/terminal.go:**
1. Add `RenderBadge(w io.Writer, scored *types.ScoredResult)` function:
   - Return early if scored is nil
   - Call GenerateBadge to get BadgeInfo
   - Print section header "Badge" with separator line
   - Print badge.Markdown

**internal/output/json.go:**
1. Add to JSONReport struct:
   - `BadgeURL string json:"badge_url,omitempty"`
   - `BadgeMarkdown string json:"badge_markdown,omitempty"`
2. Modify BuildJSONReport signature to accept `includeBadge bool` parameter
3. If includeBadge && scored != nil:
   - Call GenerateBadge
   - Set report.BadgeURL and report.BadgeMarkdown
  </action>
  <verify>
```bash
# Build and test terminal output
go build -o ars . && ./ars scan --badge . 2>/dev/null | tail -5

# Verify badge section appears in terminal output
./ars scan --badge . 2>/dev/null | grep -A2 "Badge"

# Build and test JSON output
./ars scan --badge --json . 2>/dev/null | grep badge

# Verify badge fields in JSON
./ars scan --badge --json . 2>/dev/null | jq '.badge_url, .badge_markdown'
```
Badge appears in terminal output, badge_url and badge_markdown appear in JSON.
  </verify>
  <done>
- `--badge` flag recognized by CLI
- Terminal output shows Badge section with shields.io markdown when --badge is used
- JSON output includes badge_url and badge_markdown fields when --badge is used
- Without --badge flag, no badge output appears
  </done>
</task>

<task type="auto">
  <name>Task 3: Add badge section to HTML report</name>
  <files>internal/output/html.go, internal/output/templates/report.html</files>
  <action>
**internal/output/html.go:**
1. Add to HTMLReportData struct:
   - `BadgeMarkdown string` (for copy section)
   - `BadgeURL string` (for preview)
2. In GenerateReport method:
   - Call GenerateBadge(scored) to get badge info
   - Set data.BadgeMarkdown and data.BadgeURL

**internal/output/templates/report.html:**
1. Add a "Badge" section after the recommendations section:
   - Section header: "README Badge"
   - Show preview: display the actual badge image using `<img src="{{.BadgeURL}}" alt="ARS Badge">`
   - Show markdown code in a `<code>` block with monospace font
   - Add a "Copy" button using simple JavaScript: `onclick="navigator.clipboard.writeText(this.previousElementSibling.textContent)"`
   - Style the section consistently with existing report styling

HTML structure:
```html
<section class="badge-section">
  <h2>README Badge</h2>
  <div class="badge-preview">
    <img src="{{.BadgeURL}}" alt="ARS Badge">
  </div>
  <div class="badge-code">
    <code id="badge-markdown">{{.BadgeMarkdown}}</code>
    <button onclick="navigator.clipboard.writeText(document.getElementById('badge-markdown').textContent)">Copy</button>
  </div>
</section>
```

Note: The copy button uses minimal JavaScript which is acceptable since it's for UX convenience, not functionality. The badge markdown is always visible and can be manually copied.
  </action>
  <verify>
```bash
# Generate HTML report and check for badge section
go build -o ars . && ./ars scan --output-html /tmp/report.html . 2>/dev/null
grep -A5 "badge" /tmp/report.html | head -20

# Verify badge image and markdown appear
grep "img.shields.io" /tmp/report.html
grep "badge_markdown\|badge-markdown" /tmp/report.html
```
HTML report contains badge preview image and copyable markdown.
  </verify>
  <done>
- HTML report displays badge preview (actual image from shields.io URL)
- HTML report shows badge markdown in copyable code block
- Copy button functional for copying badge markdown
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

```bash
# Full test suite passes
go test ./... -v

# Build succeeds
go build -o ars .

# Terminal badge output works
./ars scan --badge . 2>/dev/null | grep -q "shields.io" && echo "Terminal badge: PASS"

# JSON badge output works
./ars scan --badge --json . 2>/dev/null | jq -e '.badge_url' >/dev/null && echo "JSON badge: PASS"

# HTML badge section works
./ars scan --output-html /tmp/test-badge.html . 2>/dev/null && grep -q "badge" /tmp/test-badge.html && echo "HTML badge: PASS"

# Badge URL is correctly formatted
./ars scan --badge . 2>/dev/null | grep -o 'https://img.shields.io/badge/ARS-[^)]*' | head -1
```

Expected badge URL format: `https://img.shields.io/badge/ARS-Agent--Ready%208.2%2F10-green`
</verification>

<success_criteria>
Requirements coverage:
- BADGE-01: `--badge` flag generates shields.io markdown URL to stdout (terminal and JSON modes)
- BADGE-02: Badge color reflects tier (green/yellow/orange/red mapping)
- BADGE-03: Badge shows tier name and score (e.g., "Agent-Ready 8.2/10")

All success criteria from ROADMAP.md Phase 13:
1. Running `ars scan --badge` outputs a shields.io markdown URL to stdout
2. Badge color reflects the tier (red/orange/yellow/green)
3. Badge displays both tier name and numeric score
</success_criteria>

<output>
After completion, create `.planning/phases/13-badge-generation/13-01-SUMMARY.md`
</output>
