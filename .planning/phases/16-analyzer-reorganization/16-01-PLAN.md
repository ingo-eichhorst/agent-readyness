---
phase: 16-analyzer-reorganization
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - internal/analyzer/shared.go
  - internal/analyzer/analyzer.go
  - internal/analyzer/c1_code_quality/.gitkeep
  - internal/analyzer/c2_semantics/.gitkeep
  - internal/analyzer/c3_architecture/.gitkeep
  - internal/analyzer/c4_documentation/.gitkeep
  - internal/analyzer/c5_temporal/.gitkeep
  - internal/analyzer/c6_testing/.gitkeep
  - internal/analyzer/c7_agent/.gitkeep
  - internal/analyzer/c2_python.go
  - internal/analyzer/c2_typescript.go
  - internal/analyzer/c1_python.go
  - internal/analyzer/c1_typescript.go
  - internal/analyzer/c3_python.go
  - internal/analyzer/c3_typescript.go
  - internal/analyzer/c6_python.go
  - internal/analyzer/c6_typescript.go
autonomous: true

must_haves:
  truths:
    - "Shared tree-sitter helpers exported and callable from any subpackage"
    - "Root analyzer.go contains type aliases for C1-C7 analyzers"
    - "Root analyzer.go contains constructor wrappers for NewCxAnalyzer functions"
    - "Category subdirectories exist ready to receive moved files"
    - "Existing Python/TypeScript analyzer files call exported shared utilities"
  artifacts:
    - path: "internal/analyzer/shared.go"
      provides: "Exported tree-sitter helpers (WalkTree, NodeText, CountLines) and ImportGraph"
      exports: ["WalkTree", "NodeText", "CountLines", "ImportGraph", "BuildImportGraph"]
    - path: "internal/analyzer/analyzer.go"
      provides: "Type aliases and constructor wrappers for backward compatibility"
      contains: "type C1Analyzer = c1.C1Analyzer"
    - path: "internal/analyzer/c1_code_quality/"
      provides: "Empty directory for C1 analyzer files"
    - path: "internal/analyzer/c7_agent/"
      provides: "Empty directory for C7 analyzer files"
  key_links:
    - from: "internal/analyzer/analyzer.go"
      to: "internal/analyzer/c1_code_quality"
      via: "import alias"
      pattern: 'import.*c1.*".*c1_code_quality"'
    - from: "internal/analyzer/c2_python.go"
      to: "internal/analyzer/shared.go"
      via: "calls exported utilities"
      pattern: "WalkTree|NodeText|CountLines"
---

<objective>
Create the foundation for analyzer reorganization: subdirectory structure, shared utilities file with exported tree-sitter helpers, root-level re-export file with type aliases, and update existing files to use the exported utilities.

Purpose: Establish the infrastructure that allows category files to be moved without breaking existing imports from pipeline.go.
Output: 7 category subdirectories, shared.go with exported helpers, analyzer.go with type aliases and constructor wrappers, 8 existing files updated to call exported shared utilities.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-analyzer-reorganization/16-RESEARCH.md

# Current files that define shared utilities
@internal/analyzer/helpers.go
@internal/analyzer/c2_python.go (lines 329-360 for walkTree, nodeText, countLines definitions)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create category subdirectories</name>
  <files>
    internal/analyzer/c1_code_quality/
    internal/analyzer/c2_semantics/
    internal/analyzer/c3_architecture/
    internal/analyzer/c4_documentation/
    internal/analyzer/c5_temporal/
    internal/analyzer/c6_testing/
    internal/analyzer/c7_agent/
  </files>
  <action>
Create 7 subdirectories under internal/analyzer/ following the naming convention from CONTEXT.md:
- c1_code_quality/
- c2_semantics/
- c3_architecture/
- c4_documentation/
- c5_temporal/
- c6_testing/
- c7_agent/

Each directory should be created empty for now (Plan 02 will move files into them).

**Note:** No analyzer.go files are created in subdirectories. The moved files (e.g., codehealth.go, semantics.go) will contain the type definitions. When moved with `package c1`, the existing `type C1Analyzer struct` becomes `c1.C1Analyzer`.
  </action>
  <verify>
`ls -d internal/analyzer/c*/` shows all 7 directories
  </verify>
  <done>
All 7 category subdirectories exist under internal/analyzer/
  </done>
</task>

<task type="auto">
  <name>Task 2: Create shared.go with exported utilities and update callers</name>
  <files>
    internal/analyzer/shared.go
    internal/analyzer/c2_python.go
    internal/analyzer/c2_typescript.go
    internal/analyzer/c1_python.go
    internal/analyzer/c1_typescript.go
    internal/analyzer/c3_python.go
    internal/analyzer/c3_typescript.go
    internal/analyzer/c6_python.go
    internal/analyzer/c6_typescript.go
  </files>
  <action>
**Step 1: Create shared.go**

Create `internal/analyzer/shared.go` containing exported versions of shared utilities:

1. Keep existing content from helpers.go (ImportGraph type and BuildImportGraph function)

2. Add exported tree-sitter helpers (currently defined in c2_python.go as unexported):
   - `WalkTree(node *tree_sitter.Node, fn func(*tree_sitter.Node))` - walks tree depth-first
   - `NodeText(node *tree_sitter.Node, content []byte) string` - extracts node text
   - `CountLines(content []byte) int` - counts lines in content

3. Package declaration: `package analyzer`

4. Required imports:
   - `github.com/tree-sitter/go-tree-sitter`
   - `github.com/ingo/agent-readyness/internal/parser`
   - `strings`

Implementation notes:
- Export by capitalizing first letter (walkTree -> WalkTree)
- Copy the exact implementation from c2_python.go lines 329-360
- Keep ImportGraph and BuildImportGraph from helpers.go

**Step 2: Update caller files**

The following 8 files currently call the unexported functions. Update each to call the new exported versions:

| File | Functions Called | Update To |
|------|------------------|-----------|
| c1_python.go | nodeText | NodeText |
| c1_typescript.go | nodeText | NodeText |
| c2_python.go | walkTree, nodeText, countLines | WalkTree, NodeText, CountLines |
| c2_typescript.go | walkTree, nodeText, countLines | WalkTree, NodeText, CountLines |
| c3_python.go | walkTree, nodeText | WalkTree, NodeText |
| c3_typescript.go | walkTree, nodeText | WalkTree, NodeText |
| c6_python.go | walkTree, nodeText | WalkTree, NodeText |
| c6_typescript.go | walkTree, nodeText | WalkTree, NodeText |

For c2_python.go specifically:
- REMOVE the local definitions of walkTree, nodeText, countLines (lines 329-360)
- Update all calls in the same file to use the exported versions

For all other files:
- Simply rename calls from lowercase to capitalized versions
- These files currently call the unexported functions from c2_python.go (Go allows this within same package)

**Step 3: Clean up**

After creating shared.go and updating callers, delete helpers.go (its content is now in shared.go).
  </action>
  <verify>
`go build ./internal/analyzer/...` succeeds (shared.go compiles and all callers work)
`grep -c "func walkTree" internal/analyzer/*.go` returns 0 (no unexported walkTree remaining)
  </verify>
  <done>
shared.go exists with WalkTree, NodeText, CountLines, ImportGraph, and BuildImportGraph exported. helpers.go removed. All 8 caller files updated to use exported function names.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create root analyzer.go with type aliases and constructor wrappers</name>
  <files>internal/analyzer/analyzer.go</files>
  <action>
Create `internal/analyzer/analyzer.go` with:

1. Package declaration: `package analyzer`

2. Imports (will be satisfied after Plan 02 moves files):
```go
import (
    c1 "github.com/ingo/agent-readyness/internal/analyzer/c1_code_quality"
    c2 "github.com/ingo/agent-readyness/internal/analyzer/c2_semantics"
    c3 "github.com/ingo/agent-readyness/internal/analyzer/c3_architecture"
    c4 "github.com/ingo/agent-readyness/internal/analyzer/c4_documentation"
    c5 "github.com/ingo/agent-readyness/internal/analyzer/c5_temporal"
    c6 "github.com/ingo/agent-readyness/internal/analyzer/c6_testing"
    c7 "github.com/ingo/agent-readyness/internal/analyzer/c7_agent"
    "github.com/ingo/agent-readyness/internal/parser"
)
```

3. Type aliases for backward compatibility (use `=` for type identity):
```go
type C1Analyzer = c1.C1Analyzer
type C2Analyzer = c2.C2Analyzer
type C3Analyzer = c3.C3Analyzer
type C4Analyzer = c4.C4Analyzer
type C5Analyzer = c5.C5Analyzer
type C6Analyzer = c6.C6Analyzer
type C7Analyzer = c7.C7Analyzer
```

4. Constructor wrapper functions:
```go
func NewC1Analyzer(tsParser *parser.TreeSitterParser) *C1Analyzer {
    return c1.NewC1Analyzer(tsParser)
}
// ... similar for C2, C3, C4 (all take tsParser)

func NewC5Analyzer() *C5Analyzer {
    return c5.NewC5Analyzer()
}
// C6 takes tsParser, C7 takes no args
```

**Important:** The types these aliases reference (e.g., `c1.C1Analyzer`) will exist in the moved files:
- `c1.C1Analyzer` lives in `c1_code_quality/codehealth.go` (after Plan 02 moves c1_codehealth.go there)
- `c2.C2Analyzer` lives in `c2_semantics/semantics.go` (after Plan 02 moves c2_semantics.go there)
- No separate `analyzer.go` files are created in subdirectories

Note: This file will NOT compile yet because subpackages are empty. That's expected - Plan 02 will move the actual analyzer code into the subdirectories.
  </action>
  <verify>
File exists at internal/analyzer/analyzer.go with correct structure.

Verify structure even if build fails:
```
grep -q "type C1Analyzer = c1.C1Analyzer" internal/analyzer/analyzer.go && echo "Type alias OK"
grep -q "func NewC1Analyzer" internal/analyzer/analyzer.go && echo "Constructor OK"
grep -q "type C7Analyzer = c7.C7Analyzer" internal/analyzer/analyzer.go && echo "All aliases OK"
```
  </verify>
  <done>
analyzer.go exists with all 7 type aliases and 7 constructor wrappers. File structure matches RESEARCH.md template. Structure verification passes even though build fails (expected until Plan 02).
  </done>
</task>

</tasks>

<verification>
1. All 7 category directories exist: `ls internal/analyzer/c*/`
2. shared.go compiles and callers work: `go build ./internal/analyzer/...` (excluding analyzer.go)
3. helpers.go is removed
4. No unexported walkTree/nodeText/countLines remain: `grep -c "func walkTree\|func nodeText\|func countLines" internal/analyzer/*.go` returns 0
5. analyzer.go has correct structure (grep checks - won't compile until Plan 02)
</verification>

<success_criteria>
- 7 subdirectories created (c1_code_quality through c7_agent)
- shared.go exports WalkTree, NodeText, CountLines, ImportGraph, BuildImportGraph
- All 8 caller files updated to use exported function names
- analyzer.go has type aliases for C1-C7 and constructor wrappers
- helpers.go removed (consolidated into shared.go)
- Build succeeds for current analyzer files (excluding analyzer.go which depends on Plan 02)
</success_criteria>

<output>
After completion, create `.planning/phases/16-analyzer-reorganization/16-01-SUMMARY.md`
</output>
