---
phase: 30-evidence-data-flow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pkg/types/scoring.go
  - internal/scoring/config.go
  - internal/scoring/scorer.go
autonomous: true

must_haves:
  truths:
    - "EvidenceItem type exists with file_path, line, value, description fields and JSON tags"
    - "SubScore type has Evidence []EvidenceItem field with json:evidence tag (no omitempty)"
    - "MetricExtractor returns three values: rawValues, unavailable, evidence"
    - "C7 overall_score metric is removed from config (not just zero-weight)"
    - "All existing tests still pass after signature changes (compilation succeeds)"
  artifacts:
    - path: "pkg/types/scoring.go"
      provides: "EvidenceItem type and updated SubScore"
      contains: "EvidenceItem"
    - path: "internal/scoring/config.go"
      provides: "C7 config with 5 MECE metrics only"
    - path: "internal/scoring/scorer.go"
      provides: "Updated MetricExtractor signature and stub evidence returns"
  key_links:
    - from: "internal/scoring/scorer.go"
      to: "pkg/types/scoring.go"
      via: "MetricExtractor returns types.EvidenceItem"
      pattern: "map\\[string\\]\\[\\]types\\.EvidenceItem"
    - from: "internal/scoring/scorer.go"
      to: "internal/scoring/config.go"
      via: "C7 config no longer has overall_score"
      pattern: "extractC7"
---

<objective>
Define the EvidenceItem type, extend SubScore and MetricExtractor to carry evidence data, and remove the deprecated C7 overall_score metric.

Purpose: Establishes the type foundation that all 7 extractCx functions and JSON output will build on. Without these types and the updated signature, no evidence can flow through the pipeline.

Output: Compilable codebase with new types, updated function signatures, and all extractors returning stub empty evidence maps. All existing tests updated to pass.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-evidence-data-flow/30-CONTEXT.md
@.planning/phases/30-evidence-data-flow/30-RESEARCH.md
@pkg/types/scoring.go
@internal/scoring/scorer.go
@internal/scoring/config.go
@internal/scoring/scorer_test.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add EvidenceItem type and update SubScore</name>
  <files>pkg/types/scoring.go</files>
  <action>
  Add a new EvidenceItem struct to pkg/types/scoring.go:

  ```go
  // EvidenceItem represents a single worst-offender for a metric.
  type EvidenceItem struct {
      FilePath    string  `json:"file_path"`
      Line        int     `json:"line"`
      Value       float64 `json:"value"`
      Description string  `json:"description"`
  }
  ```

  Add an Evidence field to the SubScore struct:

  ```go
  Evidence   []EvidenceItem `json:"evidence"`
  ```

  IMPORTANT: Do NOT use `omitempty` on the Evidence field. The CONTEXT.md decision requires empty arrays `[]` in JSON, never `null`. The `json:"evidence"` tag without omitempty ensures this.

  Also add json tags to ALL existing SubScore fields (they currently have none). This is needed for direct JSON serialization consistency. Use these tags:
  - MetricName -> `json:"metric_name"`
  - RawValue -> `json:"raw_value"`
  - Score -> `json:"score"`
  - Weight -> `json:"weight"`
  - Available -> `json:"available"`
  </action>
  <verify>Run `go build ./...` to confirm compilation succeeds.</verify>
  <done>EvidenceItem type exists with 4 fields and JSON tags. SubScore has Evidence field with `json:"evidence"` tag (no omitempty). All SubScore fields have json tags.</done>
</task>

<task type="auto">
  <name>Task 2: Update MetricExtractor signature, remove overall_score, and make all extractors compile</name>
  <files>internal/scoring/scorer.go, internal/scoring/config.go, internal/scoring/scorer_test.go</files>
  <action>
  **In internal/scoring/config.go:**
  Remove the `overall_score` MetricThresholds entry entirely from the C7 category config. The C7 section should only have the 5 MECE metrics: task_execution_consistency, code_behavior_comprehension, cross_file_navigation, identifier_interpretability, documentation_accuracy_detection. Delete the comment block and entry for `overall_score` (lines ~447-458 in current code).

  **In internal/scoring/scorer.go:**

  1. Change the MetricExtractor type to return three values:
  ```go
  type MetricExtractor func(ar *types.AnalysisResult) (
      rawValues   map[string]float64,
      unavailable map[string]bool,
      evidence    map[string][]types.EvidenceItem,
  )
  ```

  2. Update ALL 7 extractCx functions to return a third value. For this plan, return empty evidence maps as stubs (Plan 02 will populate real evidence):
  - Each function's return signature changes to `(map[string]float64, map[string]bool, map[string][]types.EvidenceItem)`
  - Each function returns `nil` for evidence in early-return paths, and `make(map[string][]types.EvidenceItem)` in the success path
  - extractC7: Remove `overall_score` from both the available and unavailable return paths. When `!m.Available`, only list the 5 MECE metric names in the unavailable map. When available, only return the 5 MECE metric values in rawValues.

  3. Update scoreMetrics to accept and wire evidence:
  ```go
  func scoreMetrics(catConfig CategoryConfig, rawValues map[string]float64, unavailable map[string]bool, evidence map[string][]types.EvidenceItem) ([]types.SubScore, float64) {
  ```
  Inside scoreMetrics, for each SubScore:
  - Look up `ev := evidence[mt.Name]`
  - If `ev == nil`, set `ev = make([]types.EvidenceItem, 0)` (guarantees non-nil for JSON)
  - Set `ss.Evidence = ev`

  4. Update the Score() method call site (line ~156):
  ```go
  rawValues, unavailable, evidence := extractor(ar)
  ```
  And pass evidence to scoreMetrics:
  ```go
  subScores, score := scoreMetrics(catConfig, rawValues, unavailable, evidence)
  ```
  Also handle the nil extractor return case: when rawValues is nil, pass nil for evidence to scoreMetrics (or skip as before).

  **In internal/scoring/scorer_test.go:**

  Update the C7 tests:
  - TestExtractC7_ReturnsAllMetrics: Change from 6 expected keys to 5. Remove "overall_score" from expectedKeys. Remove the specific `rawValues["overall_score"]` assertion. Update the count assertion from 6 to 5.
  - TestExtractC7_UnavailableMarksAllMetrics: Remove "overall_score" from expectedUnavailable. Update count from 6 to 5.
  - TestScoreC7_NonZeroSubScores: Change expected subscore count from 6 to 5. Remove the `overall_score` exception in the MECE counting loop. The function now returns `(rawValues, unavailable)` patterns need updating to `(rawValues, unavailable, _)` or `(rawValues, unavailable, evidence)`.

  Since tests call extractC7 directly, update those calls to capture the third return value:
  ```go
  rawValues, unavailable, _ := extractC7(ar)
  ```
  </action>
  <verify>Run `go test ./internal/scoring/... -v` -- all tests pass. Run `go build ./...` -- no compilation errors.</verify>
  <done>MetricExtractor signature returns 3 values. All 7 extractors compile with stub evidence. C7 has exactly 5 metrics (overall_score removed from config, extractor, and tests). scoreMetrics wires evidence into SubScore with guaranteed non-nil arrays. All existing tests pass.</done>
</task>

</tasks>

<verification>
1. `go build ./...` compiles without errors
2. `go test ./internal/scoring/...` -- all tests pass
3. `go test ./...` -- full test suite passes (no downstream breakage from signature change)
4. Verify EvidenceItem has json tags: `grep -n 'json:"file_path"' pkg/types/scoring.go` returns a match
5. Verify overall_score removed: `grep -c 'overall_score' internal/scoring/config.go` returns 0
</verification>

<success_criteria>
- EvidenceItem type defined with FilePath, Line, Value, Description fields and json tags
- SubScore.Evidence field exists with `json:"evidence"` tag (no omitempty)
- MetricExtractor returns (rawValues, unavailable, evidence)
- scoreMetrics accepts and wires evidence into SubScore
- C7 overall_score removed from config, extractor, and tests
- All 7 extractCx functions compile (returning stub empty evidence)
- `go test ./...` passes with zero failures
</success_criteria>

<output>
After completion, create `.planning/phases/30-evidence-data-flow/30-01-SUMMARY.md`
</output>
